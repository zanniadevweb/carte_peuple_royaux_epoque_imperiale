
		<link rel='stylesheet' href='https://unpkg.com/leaflet@1.9.3/dist/leaflet.css' integrity='sha256-kLaT2GOSpHechhsozzB+flnD+zUyjE2LlfWPgU04xyI=' crossorigin=''/>
		<script src='https://unpkg.com/leaflet@1.9.3/dist/leaflet.js' integrity='sha256-WBkoXOwTeyKclOHuWtc+i2uENFpDZ9YPdf5Hf+D7ewM=' crossorigin=''></script>
		<div id='map' style='width: 100%; height: 95%; font-size: 25px; margin: 0; border-radius: 0px; border: 2px solid #3c546b;'></div>
<div style="margin: 10px 0;">    <input id="searchInput" type="text" placeholder="Rechercher par nom ou ID...">    <button onclick="validateSearch()">Rechercher</button>    <button onclick="resetSearch()">Réinitialiser</button>    <span id="searchResults"></span></div><script>
		window.jsonValues = [["ID","world_region","place_name","alt_name","geo_clue","geometry","type","biblio","Latitude","Longitude"],["0","Tunisie","Aquae Regiae (Haffouz ?)","","","point","villes et peuples 'royaux'","","35.58292","9.718677"],["1","Tunisie","Plebs Marazanensium Regiorum","Marazanae (?)","","point","villes et peuples 'royaux'","","35.562026663063236","9.493621929207416"],["2","Tunisie","Bulla Regia","","","point","villes et peuples 'royaux'","","36.558800741051954","8.753890324119414"],["3","Algérie","Regiae (Arbal ?)","Arbal","près d'Oran","polygone","villes et peuples 'royaux'","","35.45741168966","-0.6189451812869332"],["4","Algérie","Suburbures Regiani","","Ouest de Cirta","polygone","villes et peuples 'royaux'","","36.1110044247403","6.944821350826414"],["5","Algérie","Hippo Regius","","","polygon","villes et peuples 'royaux'","","36.88217983962333","7.749633804536083"],["6","Algérie","Villa Regia","évêché Villaregiensis / Tubunae/Tobna","près de Thubunae / Tobna","polygone","villes et peuples 'royaux'","","35.348951973640396","5.3458467750285035"],["7","Algérie","Lacus regius","Sebkhet Djenndli","","point","villes et peuples 'royaux'","https://journals.openedition.org/encyclopedieberbere/551?lang=fr","35.70221328595271","6.492804765968611"],["8","Tunisie","Musuni Regiani","","","polygone","villes et peuples 'royaux'","","35.05036865796037","8.69649236122013"],["9","Tunisie","Thimida Regia","La Mohammedia (?)","","point","villes et peuples 'royaux'","","36.64092032076405","10.14192979819157"],["10","Tunisie","Zama Regia","","","point","villes et peuples 'royaux'","","36.11186690594038","9.285526022409872"],["11","Algérie","Siga","","","point","communautés en relation avec les rois mais sans le qualificatif 'royal'","","36.272140","6.725088"],["12","Tunisie","Simitthus","","","point","communautés en relation avec les rois mais sans le qualificatif 'royal'","","36.49184915169899","8.574790540353776"],["13","Tunisie","Thala","","","point","communautés en relation avec les rois mais sans le qualificatif 'royal'","","35.575759170222625","8.6699447911646"],["14","Tunisie","Thysdrus","","","point","communautés en relation avec les rois mais sans le qualificatif 'royal'","","35.299991203369366","10.716717293299878"],["15","Algérie","Mausolée royal ; Tipasa","","","point","communautés en relation avec les rois mais sans le qualificatif 'royal'","","36.59410844333932","2.443390206032822"],["16","Algérie","Iol-Caesarea","Cherchell","","point","communautés en relation avec les rois mais sans le qualificatif 'royal'","","36.60768055416968","2.1905412037127863"],["17","Tunisie","Capsa","Gafsa","","point","communautés en relation avec les rois mais sans le qualificatif 'royal'","","34.41678149094534","8.783467772370525"],["18","Tunisie","Tingi","Tangier","","point","communautés en relation avec les rois mais sans le qualificatif 'royal'","","35.78336823394947","-5.816696932730005"],["19","Tunisie","Lixus","","","point","communautés en relation avec les rois mais sans le qualificatif 'royal'","","35.20083324400923","-6.098552567585296"],["20","Tunisie","Volubilis","","","point","communautés en relation avec les rois mais sans le qualificatif 'royal'","","34.07282459447863","-5.554618554615739"],["21","Tunisie","Gilda","Riha","","point","communautés en relation avec les rois mais sans le qualificatif 'royal'","","34.18366443451519","-5.555025682089317"],["22","Algérie","Thudedenses","Castellum des ","","point","communautés en relation avec les rois mais sans le qualificatif 'royal'","","36.57774243266451","2.5430522464753653"],["23","Maroc","Castellum de la Mulucha","","","point","communautés en relation avec les rois mais sans le qualificatif 'royal'","","33.74928579960535","-3.5567503103836797"],["24","Algérie","Cirta","","","point","communautés en relation avec les rois mais sans le qualificatif 'royal'","","36.36338070322103","6.607072682317123"],["25","Algérie","Theveste","","","point","autres villes","","35.406553139541393","8.116803836460225"],["26","Algérie","Thubunae","Tobna","","point","autres villes","","35.34834749851243","5.351464468388069"],["27","Tunisie","Mactar","","","point","autres villes","","35.85532181583911","9.208245798625953"],["28","Algérie","Medracen (mausolée royal)","","","point","autres villes","","35.707103","6.434614"],["29","Tunisie","Sicca","","","point","autres villes","","36.17382658344858","8.704080058583148"],["30","Tunisie","Thelepte","","","point","autres villes","","34.966660130622884","8.584326158547299"],["31","Tunisie","Thugga","","","point","autres villes","","36.420154","9.220169"],["32","Tunisie","Cillium","Kasserine","","point","autres villes","","35.1667190540806","8.83329066422902"],["33","Tunisie","Carthage","","","point","autres villes","","36.850806409922974","10.328663013074339"],["34","Tunisie","Sufetula","Sbeïtla","","point","autres villes","","35.24066088740784","9.119673109932092"],["35","Tunisie","Ammaedara","Haïdra","","point","autres villes","","35.24066088740784","9.119673109932092"],["36","Tunisie","Vthina","","","point","autres villes","","36.610426042303494","10.1692145628974"],["37","Tunisie","Sufes","","","point","autres villes","","35.546824481410084","9.073585399300068"],["38","Tunisie","Thuscae","","","polygon","foncier","","35.9223989","9.2434078"]];
		markersJsonGlobal = [{"customMarkerIcon":"assets/css/images/villes_et_peuples_royaux.png"},{"customMarkerIcon":"assets/css/images/villes_et_peuples_royaux.png"},{"customMarkerIcon":"assets/css/images/villes_et_peuples_royaux.png"},{"customMarkerIcon":"assets/css/images/villes_et_peuples_royaux.png"},{"customMarkerIcon":"assets/css/images/villes_et_peuples_royaux.png"},{"customMarkerIcon":"assets/css/images/villes_et_peuples_royaux.png"},{"customMarkerIcon":"assets/css/images/villes_et_peuples_royaux.png"},{"customMarkerIcon":"assets/css/images/villes_et_peuples_royaux.png"},{"customMarkerIcon":"assets/css/images/villes_et_peuples_royaux.png"},{"customMarkerIcon":"assets/css/images/villes_et_peuples_royaux.png"},{"customMarkerIcon":"assets/css/images/villes_et_peuples_royaux.png"},{"customMarkerIcon":"assets/css/images/communautes_royales.png"},{"customMarkerIcon":"assets/css/images/communautes_royales.png"},{"customMarkerIcon":"assets/css/images/communautes_royales.png"},{"customMarkerIcon":"assets/css/images/communautes_royales.png"},{"customMarkerIcon":"assets/css/images/communautes_royales.png"},{"customMarkerIcon":"assets/css/images/communautes_royales.png"},{"customMarkerIcon":"assets/css/images/communautes_royales.png"},{"customMarkerIcon":"assets/css/images/communautes_royales.png"},{"customMarkerIcon":"assets/css/images/communautes_royales.png"},{"customMarkerIcon":"assets/css/images/communautes_royales.png"},{"customMarkerIcon":"assets/css/images/communautes_royales.png"},{"customMarkerIcon":"assets/css/images/communautes_royales.png"},{"customMarkerIcon":"assets/css/images/communautes_royales.png"},{"customMarkerIcon":"assets/css/images/communautes_royales.png"},{"customMarkerIcon":"assets/css/images/autres_villes.png"},{"customMarkerIcon":"assets/css/images/autres_villes.png"},{"customMarkerIcon":"assets/css/images/autres_villes.png"},{"customMarkerIcon":"assets/css/images/autres_villes.png"},{"customMarkerIcon":"assets/css/images/autres_villes.png"},{"customMarkerIcon":"assets/css/images/autres_villes.png"},{"customMarkerIcon":"assets/css/images/autres_villes.png"},{"customMarkerIcon":"assets/css/images/autres_villes.png"},{"customMarkerIcon":"assets/css/images/autres_villes.png"},{"customMarkerIcon":"assets/css/images/autres_villes.png"},{"customMarkerIcon":"assets/css/images/autres_villes.png"},{"customMarkerIcon":"assets/css/images/autres_villes.png"},{"customMarkerIcon":"assets/css/images/autres_villes.png"},{"customMarkerIcon":"assets/css/images/villes_et_peuples_royaux.png"}];

		isUsingDefaultMarkers = markersJsonGlobal !== null ? false : true;

		isUsingCustomIcon = true;

		isUsingLabelsForMarkers = [true,2];

		markers = [];

		var map = L.map('map').setView([32.89823507586223,3.4796224380653804], 6);

		var iPointsArray = [["35.58292","9.718677","ID = 0</br>WORLD_REGION = Tunisie</br>PLACE_NAME = Aquae Regiae (Haffouz ?)</br>GEOMETRY = point</br>TYPE = villes et peuples 'royaux'</br>LATITUDE = 35.58292</br>LONGITUDE = 9.718677"],["35.562026663063236","9.493621929207416","ID = 1</br>WORLD_REGION = Tunisie</br>PLACE_NAME = Plebs Marazanensium Regiorum</br>ALT_NAME = Marazanae (?)</br>GEOMETRY = point</br>TYPE = villes et peuples 'royaux'</br>LATITUDE = 35.562026663063236</br>LONGITUDE = 9.493621929207416"],["36.558800741051954","8.753890324119414","ID = 2</br>WORLD_REGION = Tunisie</br>PLACE_NAME = Bulla Regia</br>GEOMETRY = point</br>TYPE = villes et peuples 'royaux'</br>LATITUDE = 36.558800741051954</br>LONGITUDE = 8.753890324119414"],["35.45741168966","-0.6189451812869332","ID = 3</br>WORLD_REGION = Algérie</br>PLACE_NAME = Regiae (Arbal ?)</br>ALT_NAME = Arbal</br>GEO_CLUE = près d'Oran</br>GEOMETRY = polygone</br>TYPE = villes et peuples 'royaux'</br>LATITUDE = 35.45741168966</br>LONGITUDE = -0.6189451812869332"],["36.1110044247403","6.944821350826414","ID = 4</br>WORLD_REGION = Algérie</br>PLACE_NAME = Suburbures Regiani</br>GEO_CLUE = Ouest de Cirta</br>GEOMETRY = polygone</br>TYPE = villes et peuples 'royaux'</br>LATITUDE = 36.1110044247403</br>LONGITUDE = 6.944821350826414"],["36.88217983962333","7.749633804536083","ID = 5</br>WORLD_REGION = Algérie</br>PLACE_NAME = Hippo Regius</br>GEOMETRY = polygon</br>TYPE = villes et peuples 'royaux'</br>LATITUDE = 36.88217983962333</br>LONGITUDE = 7.749633804536083"],["35.348951973640396","5.3458467750285035","ID = 6</br>WORLD_REGION = Algérie</br>PLACE_NAME = Villa Regia</br>ALT_NAME = évêché Villaregiensis / Tubunae/Tobna</br>GEO_CLUE = près de Thubunae / Tobna</br>GEOMETRY = polygone</br>TYPE = villes et peuples 'royaux'</br>LATITUDE = 35.348951973640396</br>LONGITUDE = 5.3458467750285035"],["35.70221328595271","6.492804765968611","ID = 7</br>WORLD_REGION = Algérie</br>PLACE_NAME = Lacus regius</br>ALT_NAME = Sebkhet Djenndli</br>GEOMETRY = point</br>TYPE = villes et peuples 'royaux'</br>BIBLIO = <a href=\"https://journals.openedition.org/encyclopedieberbere/551?lang=fr\" target=\"_blank\">journals.openedition.org/encyclopedieberbere/551?lang=fr</a></br>LATITUDE = 35.70221328595271</br>LONGITUDE = 6.492804765968611"],["35.05036865796037","8.69649236122013","ID = 8</br>WORLD_REGION = Tunisie</br>PLACE_NAME = Musuni Regiani</br>GEOMETRY = polygone</br>TYPE = villes et peuples 'royaux'</br>LATITUDE = 35.05036865796037</br>LONGITUDE = 8.69649236122013"],["36.64092032076405","10.14192979819157","ID = 9</br>WORLD_REGION = Tunisie</br>PLACE_NAME = Thimida Regia</br>ALT_NAME = La Mohammedia (?)</br>GEOMETRY = point</br>TYPE = villes et peuples 'royaux'</br>LATITUDE = 36.64092032076405</br>LONGITUDE = 10.14192979819157"],["36.11186690594038","9.285526022409872","ID = 10</br>WORLD_REGION = Tunisie</br>PLACE_NAME = Zama Regia</br>GEOMETRY = point</br>TYPE = villes et peuples 'royaux'</br>LATITUDE = 36.11186690594038</br>LONGITUDE = 9.285526022409872"],["36.272140","6.725088","ID = 11</br>WORLD_REGION = Algérie</br>PLACE_NAME = Siga</br>GEOMETRY = point</br>TYPE = communautés en relation avec les rois mais sans le qualificatif 'royal'</br>LATITUDE = 36.272140</br>LONGITUDE = 6.725088"],["36.49184915169899","8.574790540353776","ID = 12</br>WORLD_REGION = Tunisie</br>PLACE_NAME = Simitthus</br>GEOMETRY = point</br>TYPE = communautés en relation avec les rois mais sans le qualificatif 'royal'</br>LATITUDE = 36.49184915169899</br>LONGITUDE = 8.574790540353776"],["35.575759170222625","8.6699447911646","ID = 13</br>WORLD_REGION = Tunisie</br>PLACE_NAME = Thala</br>GEOMETRY = point</br>TYPE = communautés en relation avec les rois mais sans le qualificatif 'royal'</br>LATITUDE = 35.575759170222625</br>LONGITUDE = 8.6699447911646"],["35.299991203369366","10.716717293299878","ID = 14</br>WORLD_REGION = Tunisie</br>PLACE_NAME = Thysdrus</br>GEOMETRY = point</br>TYPE = communautés en relation avec les rois mais sans le qualificatif 'royal'</br>LATITUDE = 35.299991203369366</br>LONGITUDE = 10.716717293299878"],["36.59410844333932","2.443390206032822","ID = 15</br>WORLD_REGION = Algérie</br>PLACE_NAME = Mausolée royal ; Tipasa</br>GEOMETRY = point</br>TYPE = communautés en relation avec les rois mais sans le qualificatif 'royal'</br>LATITUDE = 36.59410844333932</br>LONGITUDE = 2.443390206032822"],["36.60768055416968","2.1905412037127863","ID = 16</br>WORLD_REGION = Algérie</br>PLACE_NAME = Iol-Caesarea</br>ALT_NAME = Cherchell</br>GEOMETRY = point</br>TYPE = communautés en relation avec les rois mais sans le qualificatif 'royal'</br>LATITUDE = 36.60768055416968</br>LONGITUDE = 2.1905412037127863"],["34.41678149094534","8.783467772370525","ID = 17</br>WORLD_REGION = Tunisie</br>PLACE_NAME = Capsa</br>ALT_NAME = Gafsa</br>GEOMETRY = point</br>TYPE = communautés en relation avec les rois mais sans le qualificatif 'royal'</br>LATITUDE = 34.41678149094534</br>LONGITUDE = 8.783467772370525"],["35.78336823394947","-5.816696932730005","ID = 18</br>WORLD_REGION = Tunisie</br>PLACE_NAME = Tingi</br>ALT_NAME = Tangier</br>GEOMETRY = point</br>TYPE = communautés en relation avec les rois mais sans le qualificatif 'royal'</br>LATITUDE = 35.78336823394947</br>LONGITUDE = -5.816696932730005"],["35.20083324400923","-6.098552567585296","ID = 19</br>WORLD_REGION = Tunisie</br>PLACE_NAME = Lixus</br>GEOMETRY = point</br>TYPE = communautés en relation avec les rois mais sans le qualificatif 'royal'</br>LATITUDE = 35.20083324400923</br>LONGITUDE = -6.098552567585296"],["34.07282459447863","-5.554618554615739","ID = 20</br>WORLD_REGION = Tunisie</br>PLACE_NAME = Volubilis</br>GEOMETRY = point</br>TYPE = communautés en relation avec les rois mais sans le qualificatif 'royal'</br>LATITUDE = 34.07282459447863</br>LONGITUDE = -5.554618554615739"],["34.18366443451519","-5.555025682089317","ID = 21</br>WORLD_REGION = Tunisie</br>PLACE_NAME = Gilda</br>ALT_NAME = Riha</br>GEOMETRY = point</br>TYPE = communautés en relation avec les rois mais sans le qualificatif 'royal'</br>LATITUDE = 34.18366443451519</br>LONGITUDE = -5.555025682089317"],["36.57774243266451","2.5430522464753653","ID = 22</br>WORLD_REGION = Algérie</br>PLACE_NAME = Thudedenses</br>ALT_NAME = Castellum des </br>GEOMETRY = point</br>TYPE = communautés en relation avec les rois mais sans le qualificatif 'royal'</br>LATITUDE = 36.57774243266451</br>LONGITUDE = 2.5430522464753653"],["33.74928579960535","-3.5567503103836797","ID = 23</br>WORLD_REGION = Maroc</br>PLACE_NAME = Castellum de la Mulucha</br>GEOMETRY = point</br>TYPE = communautés en relation avec les rois mais sans le qualificatif 'royal'</br>LATITUDE = 33.74928579960535</br>LONGITUDE = -3.5567503103836797"],["36.36338070322103","6.607072682317123","ID = 24</br>WORLD_REGION = Algérie</br>PLACE_NAME = Cirta</br>GEOMETRY = point</br>TYPE = communautés en relation avec les rois mais sans le qualificatif 'royal'</br>LATITUDE = 36.36338070322103</br>LONGITUDE = 6.607072682317123"],["35.406553139541393","8.116803836460225","ID = 25</br>WORLD_REGION = Algérie</br>PLACE_NAME = Theveste</br>GEOMETRY = point</br>TYPE = autres villes</br>LATITUDE = 35.406553139541393</br>LONGITUDE = 8.116803836460225"],["35.34834749851243","5.351464468388069","ID = 26</br>WORLD_REGION = Algérie</br>PLACE_NAME = Thubunae</br>ALT_NAME = Tobna</br>GEOMETRY = point</br>TYPE = autres villes</br>LATITUDE = 35.34834749851243</br>LONGITUDE = 5.351464468388069"],["35.85532181583911","9.208245798625953","ID = 27</br>WORLD_REGION = Tunisie</br>PLACE_NAME = Mactar</br>GEOMETRY = point</br>TYPE = autres villes</br>LATITUDE = 35.85532181583911</br>LONGITUDE = 9.208245798625953"],["35.707103","6.434614","ID = 28</br>WORLD_REGION = Algérie</br>PLACE_NAME = Medracen (mausolée royal)</br>GEOMETRY = point</br>TYPE = autres villes</br>LATITUDE = 35.707103</br>LONGITUDE = 6.434614"],["36.17382658344858","8.704080058583148","ID = 29</br>WORLD_REGION = Tunisie</br>PLACE_NAME = Sicca</br>GEOMETRY = point</br>TYPE = autres villes</br>LATITUDE = 36.17382658344858</br>LONGITUDE = 8.704080058583148"],["34.966660130622884","8.584326158547299","ID = 30</br>WORLD_REGION = Tunisie</br>PLACE_NAME = Thelepte</br>GEOMETRY = point</br>TYPE = autres villes</br>LATITUDE = 34.966660130622884</br>LONGITUDE = 8.584326158547299"],["36.420154","9.220169","ID = 31</br>WORLD_REGION = Tunisie</br>PLACE_NAME = Thugga</br>GEOMETRY = point</br>TYPE = autres villes</br>LATITUDE = 36.420154</br>LONGITUDE = 9.220169"],["35.1667190540806","8.83329066422902","ID = 32</br>WORLD_REGION = Tunisie</br>PLACE_NAME = Cillium</br>ALT_NAME = Kasserine</br>GEOMETRY = point</br>TYPE = autres villes</br>LATITUDE = 35.1667190540806</br>LONGITUDE = 8.83329066422902"],["36.850806409922974","10.328663013074339","ID = 33</br>WORLD_REGION = Tunisie</br>PLACE_NAME = Carthage</br>GEOMETRY = point</br>TYPE = autres villes</br>LATITUDE = 36.850806409922974</br>LONGITUDE = 10.328663013074339"],["35.24066088740784","9.119673109932092","ID = 34</br>WORLD_REGION = Tunisie</br>PLACE_NAME = Sufetula</br>ALT_NAME = Sbeïtla</br>GEOMETRY = point</br>TYPE = autres villes</br>LATITUDE = 35.24066088740784</br>LONGITUDE = 9.119673109932092"],["35.24066088740784","9.119673109932092","ID = 35</br>WORLD_REGION = Tunisie</br>PLACE_NAME = Ammaedara</br>ALT_NAME = Haïdra</br>GEOMETRY = point</br>TYPE = autres villes</br>LATITUDE = 35.24066088740784</br>LONGITUDE = 9.119673109932092"],["36.610426042303494","10.1692145628974","ID = 36</br>WORLD_REGION = Tunisie</br>PLACE_NAME = Vthina</br>GEOMETRY = point</br>TYPE = autres villes</br>LATITUDE = 36.610426042303494</br>LONGITUDE = 10.1692145628974"],["35.546824481410084","9.073585399300068","ID = 37</br>WORLD_REGION = Tunisie</br>PLACE_NAME = Sufes</br>GEOMETRY = point</br>TYPE = autres villes</br>LATITUDE = 35.546824481410084</br>LONGITUDE = 9.073585399300068"],["35.9223989","9.2434078","ID = 38</br>WORLD_REGION = Tunisie</br>PLACE_NAME = Thuscae</br>GEOMETRY = polygon</br>TYPE = foncier</br>LATITUDE = 35.9223989</br>LONGITUDE = 9.2434078"]];

		new L.tileLayer('https://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}.png', {
		attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> <a href="https://github.com/zanniadevweb/cms_r-lite-web-gis">- Customized by Alexandre Zanni</a>',
		maxNativeZoom:19,
		maxZoom: 19,
		noWrap: true
		}).addTo(map);
		L.control.scale().addTo(map);

		var legend = L.control({position: 'bottomright'});
		legend.onAdd = function (map) {
			var div = L.DomUtil.create('div', 'leaflet-legend');
			div.style.background = 'white';
			div.style.padding = '8px 12px';
			div.style.border = '1px solid #ccc';
			div.style.borderRadius = '6px';
			div.style.boxShadow = '0 2px 6px rgba(0,0,0,0.1)';
			div.innerHTML = '<b>Communautés « royales » à l’époque impériale</b><br>' +
				'<span style="padding-right: 10px;"><img src="assets/css/images/region.png" style="width:18px; vertical-align:middle;"> Régions</span>'+
				'<span style="padding-right: 10px;"><img src="assets/css/images/villes_et_peuples_royaux.png" style="width:18px; vertical-align:middle;"> Villes et peuples royaux</span>'+
				'<span style="padding-right: 10px;"><img src="assets/css/images/communautes_royales.png" style="width:18px; vertical-align:middle;"> Communautés en relations avec les rois mais sans le qualificatif "royal"</span>'+
				'<span style="padding-right: 10px;"><img src="assets/css/images/autres_villes.png" style="width:18px; vertical-align:middle;"> Autres villes</span>';
			return div;
		};
		legend.addTo(map);

		fillPolygons(["([35.040545624860655, 8.583729861334845], [35.09002693013859, 8.616696162949179], [35.02029462927618, 8.88317376766478],  [34.970771077885225, 8.84746027424928]).color('#FF0000').tooltip(\"Musunii Regiani\")","([35.557433557600014,9.423592376162905],[35.6065707069241,9.45655327236588],[35.61103622531263,9.543075624898751],[35.579772362977,9.58702348650272],[35.531736232894666,9.5526892196246],[35.53061877112452,9.474407091142512]).color('#ff0000').tooltip(\"Marazanenses regii (?)\")","([35.38486738701638,6.501392886388966],[35.43522896808807,6.6195027644496705],[35.426278098323614,6.787053986814878],[35.369192922243535,6.877696451373102],[35.275082219497804,6.898297011499982],[35.20218332227238,6.817268141667606],[35.18647344710413,6.6620772553785335],[35.241444716562235,6.49864614503872],[35.32887317723139,6.479418955586983]).color('#ff0000').tooltip(\"Mazices Reg(iani) Montens(es) (?)\")"]);

		for (var iPoints = 0; iPoints < iPointsArray.length; iPoints++) {
			createPoint(iPointsArray[iPoints][0],iPointsArray[iPoints][1],iPointsArray[iPoints][2], iPoints);
		}

		function fillPolygons(polygonLinesForHtmlExport) {
			if (polygonLinesForHtmlExport !== '') {
				if (polygonLinesForHtmlExport.includes('|')) {
					fillPolygonsLoop(polygonLinesForHtmlExport.split('|'));
				} else {
					fillPolygonsLoop(polygonLinesForHtmlExport);
				}
			}
		}

		function fillPolygonsLoop(polygonLinesFromFile) {
			var currPolyPointValues = '';
			var currPolyPointValSeparated = [];
			var currPolyPointValue = '';
			var currPolyPointValuesAsArray = [];
			var currPolyPointsColor = '';
			var currPolyPointsTooltip = '';
			for (var ipolygonLinesFromFile = 0; ipolygonLinesFromFile < polygonLinesFromFile.length; ipolygonLinesFromFile++) {
				if (polygonLinesFromFile[ipolygonLinesFromFile] !== '') {
					currPolyPointValues = polygonLinesFromFile[ipolygonLinesFromFile].split('.color')[0].replace('(','').replace(')','');
					currPolyPointsColor = polygonLinesFromFile[ipolygonLinesFromFile].split('.color(')[1].split(')')[0].replaceAll('\'','');
					currPolyPointsTooltip = polygonLinesFromFile[ipolygonLinesFromFile].split('.tooltip(')[1].replaceAll('"','').slice(0,-1);

					currPolyPointValSeparated = currPolyPointValues.split(']');
					for (var icurrPolyPointValues = 0; icurrPolyPointValues < currPolyPointValSeparated.length; icurrPolyPointValues++) {
						if ( currPolyPointValSeparated[icurrPolyPointValues] !== '') {
							currPolyPointValue = currPolyPointValSeparated[icurrPolyPointValues].split('[')[1];
							currPolyPointValuesAsArray.push(currPolyPointValue.replace(' ', '').split(','));
						}
					}
					createPolygon([currPolyPointValuesAsArray], currPolyPointsColor, currPolyPointsTooltip);
					currPolyPointValuesAsArray = [];
					currPolyPointsColor = '';
					currPolyPointsTooltip = '';
				}
			}
		}

		function createPolygon(polyPointsValues, polyPointsColor, polyPointsTooltip) {
			new L.polygon(polyPointsValues).setStyle({fillColor: polyPointsColor, color: polyPointsColor}).addTo(map).bindTooltip(polyPointsTooltip, {permanent: false, direction:"center"});
		}

		function createPoint(latitude, longitude, label, markerId) {
			if (isUsingCustomIcon === true && markersJsonGlobal !== null && markersJsonGlobal[markerId] !== undefined && markersJsonGlobal[markerId].customMarkerIcon) {
				var customMarkerIcon = L.icon({
					iconUrl: markersJsonGlobal[markerId].customMarkerIcon,
					// shadowUrl: 'leaf-shadow.png',
				
					iconSize:     [20, 30], // size of the icon
					// shadowSize:   [50, 64], // size of the shadow
					// iconAnchor:   [22, 94], // point of the icon which will correspond to marker's location
					// shadowAnchor: [4, 62],  // the same for the shadow
					// popupAnchor:  [-3, -76] // point from which the popup should open relative to the iconAnchor
				});
				var paramCustomMarkerIcon = {icon: customMarkerIcon};
				markers[markerId] = new L.marker([latitude,longitude], paramCustomMarkerIcon).bindPopup(label + '</br>').addTo(map);
			} else if (markersJsonGlobal !== null && markersJsonGlobal[markerId] !== undefined && markersJsonGlobal[markerId].fillColor) {
				var paramCustomMarkerIcon = {  
					fillColor: markersJsonGlobal[markerId].fillColor, // '#3CC1F1'
					fillOpacity: markersJsonGlobal[markerId].fillOpacity, // 1.0
					color: markersJsonGlobal[markerId].borderColor, // black
					weight: markersJsonGlobal[markerId].borderWeight,  // 0.2
					radius: markersJsonGlobal[markerId].circleRadius, // 2000
					stroke: markersJsonGlobal[markerId].hasBorder     // true,
				}
				markers[markerId] = new L.circle([latitude,longitude], paramCustomMarkerIcon).bindPopup(label + '</br>').addTo(map);
			} else {
				var customMarkerIcon = ""
				markers[markerId] = new L.marker([latitude,longitude], paramCustomMarkerIcon).bindPopup(label + '</br>').addTo(map);
			}
			if (isUsingLabelsForMarkers[0] && isUsingLabelsForMarkers[1]) {
				var labelText = '';
				try {
					var row = window.jsonValues && window.jsonValues[Number(markerId) + 1];
					var parts = [];
					for (var i = 1; i < isUsingLabelsForMarkers.length; i++) {
						var col = isUsingLabelsForMarkers[i];
						if (col === null || col === undefined || col === '') continue;
						var colIndex = Number(col);
						if (isNaN(colIndex)) continue;
						if (row && row[colIndex] !== undefined && String(row[colIndex]).trim() !== '') {
							parts.push(String(row[colIndex]).trim());
						}
					}
					// fallback if nothing collected
					if (parts.length === 0 && row) parts.push(String(row[2] || row[1] || row[0] || '').trim());
					labelText = parts.join(' - ');
				} catch (e) { labelText = ''; }
				if (labelText) {
					markers[markerId].bindTooltip(labelText, {
						permanent: true,
						direction: 'right',
						offset: [8, 0],
						className: 'marker-label'
					});
				}
				if (labelText) {
					markers[markerId].bindTooltip(labelText, {
						permanent: true,
						direction: 'right',
						offset: [8, 0],
						className: 'marker-label'
					});
				}
			(function insertMarkerLabelStyle(){
			if (document.getElementById('marker-label-style')) return;
                var css = [
                  ".leaflet-tooltip.marker-label, .marker-label {",
                  "  border: none !important;",
                  "  box-shadow: none !important;",
                  "  color: #000 !important;",
                  "  padding: 0 6px !important;",
                  "  white-space: nowrap;",
                  "  pointer-events: none;",
                  "  font-size: 13px;",
                  "  line-height: 1;",
                  "  text-shadow: none !important;",
                  "}",
                  ".leaflet-tooltip.marker-label::before, .marker-label::before {",
                  "  display: none !important;",
                  "}"
                ].join('\n');
				var style = document.createElement('style');
				style.id = 'marker-label-style';
				style.type = 'text/css';
				style.appendChild(document.createTextNode(css));
				document.head.appendChild(style);
			})();
			}
		}

		function validateSearch() {
            const query = document.getElementById('searchInput').value.trim().toLowerCase();
            if (!query) {
                alert("Veuillez saisir un terme de recherche");
                return;
            }
            markers.forEach(marker => map.removeLayer(marker));
            const results = markers.filter(marker => {
                const popupContent = marker.getPopup()?.getContent()?.toLowerCase() || "";
                return popupContent.includes(query);
            });
            results.forEach(marker => marker.addTo(map));
            if (results.length === 0) {
                document.getElementById('searchResults').textContent = "Aucun résultat trouvé";
                return;
            }
            map.fitBounds(L.featureGroup(results).getBounds());
            document.getElementById('searchResults').textContent = `${results.length} résultat(s) trouvé(s)`;
        }

        function resetSearch() {
            document.getElementById('searchInput').value = '';
            document.getElementById('searchResults').textContent = '';
            markers.forEach(marker => marker.addTo(map));
        }
	</script>